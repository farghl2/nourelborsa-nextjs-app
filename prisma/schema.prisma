// Prisma schema for Postgres
// You can add your models below. This starts with a minimal setup.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  ACCOUNTANT
}

model User {
  id             String          @id @default(cuid())
  name           String?
  email          String?         @unique
  emailVerified  DateTime?
  image          String?
  password       String?
  role           Role            @default(USER)
  purificationCount Int?           @default(3)     // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙŠØ²Ø© Ø§Ù„ØªØ·Ù‡ÙŠØ±
  accounts       Account[]
  sessions       Session[]
  subscriptions  Subscription[]
  payments       Payment[]                    
  createdPlans   SubscriptionPlan[]             @relation("UserCreatedPlans")
  createdStocks  Stock[]                        @relation("UserCreatedStocks")
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
}


model Account {
  id                String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?  @db.Text
  access_token      String?  @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?  @db.Text
  session_state     String?
  user              User     @relation(fields: [userId], references: [id])

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model SubscriptionPlan {
  id           String           @id @default(cuid())
  name         String
  description  String?
  price        Float
  durationDays Int
  features     String[]         @default([])
  purificationLimit Int?           @default(0)  //  Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙŠØ²Ø© "Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ù‡ÙŠØ±
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  createdById  String?
  createdBy    User?             @relation("UserCreatedPlans", fields: [createdById], references: [id]) // âœ… Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­
  subscriptions Subscription[]
  active Boolean @default(true)
  allowedStocks Boolean @default(false)
}


model Subscription {
  id             String            @id @default(cuid())
  userId         String
  planId         String
  status         SubscriptionStatus @default(ACTIVE)
  startDate      DateTime           @default(now())
  endDate        DateTime?
  renewedByAdmin Boolean            @default(false) // ğŸ‘ˆ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ
  paymentId      String?
  allowedStocks Boolean @default(false)
  user           User               @relation(fields: [userId], references: [id])
  plan           SubscriptionPlan   @relation(fields: [planId], references: [id])
  payment        Payment?           @relation(fields: [paymentId], references: [id])
}

model Payment {
  id             String    @id @default(cuid())
  userId         String
  amount         Float
  currency       String     @default("usd")
  status         PaymentStatus
  transactionId  String?
  createdAt      DateTime   @default(now())
  user           User       @relation(fields: [userId], references: [id])
  subscription   Subscription[]
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
}

enum PaymentStatus {
  SUCCEEDED
  PENDING
  FAILED
}

model Stock {
  id                               String    @id @default(cuid())
  name                               String
  price                            Float    @default(0)
  symbol                           String    @unique
  description                      String?
  createdById                      String
  active                           Boolean @default(true)
  createdBy                        User      @relation("UserCreatedStocks", fields: [createdById], references: [id])
  createdAt                        DateTime  @default(now())
  updatedAt                        DateTime  @updatedAt
  companyActivity                  String?   // Ù†Ø´Ø§Ø· Ø§Ù„Ø´Ø±ÙƒØ©
  prohibitedRevenuePercentage      Float?    // Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø±Ù…Ø©
  interestBearingLoansPercentage   Float?    // Ù†Ø³Ø¨Ø© Ø§Ù„Ù‚Ø±ÙˆØ¶ Ø§Ù„Ø±Ø¨ÙˆÙŠØ©
  interestBearingDepositsPercentage Float?   // Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø¨ÙˆÙŠØ©
  assetsPercentage                 Float?    // Ù†Ø³Ø¨Ø© Ø§Ù„Ø£ØµÙˆÙ„
  totalAssets                      Float?    // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆÙ„
  marketCapitalization             Float?    // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©
  recommendation                   Boolean   @default(false) // Ù†Ù†ØµØ­ Ø¨Ø§Ù„Ø§Ø­ØªÙØ§Ø¸
  durationDays                     Int?       // Ø§Ù„Ù…Ø¯Ø©
  returnOnPrice                    Float?    // Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø±
  fairValue                        Float?    // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ø§Ø¯Ù„Ø©
  earningsPerShare                 Float?    // Ø±Ø¨Ø­ÙŠØ© Ø§Ù„Ø³Ù‡Ù…
  expectedFairValueNextYear        Float?    // Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ø§Ø¯Ù„Ø© Ù„Ù„Ø³Ù†Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  expectedEarningsPerShare         Float?    // Ù…ØªÙˆÙ‚Ø¹ Ø±Ø¨Ø­ÙŠØ© Ø§Ù„Ø³Ù‡Ù…
  purificationPercentage           Float?    // Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ù‡ÙŠØ±
}
